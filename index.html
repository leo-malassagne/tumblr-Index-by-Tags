<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<link rel="stylesheet" type="text/css" href="https://unpkg.com/leaflet@1.0.2/dist/leaflet.css" />
		<link rel="stylesheet" type="text/css" href="main.css" />
		<script src="https://unpkg.com/leaflet@1.0.2/dist/leaflet.js"></script>
		<script src="tumblrRequest.js" type="text/javascript"></script>
		<script src="createIndex.js" type="text/javascript"></script>
		<script src="createMap.js" type="text/javascript"></script>
		<script>
			var data = {},
				sorting = {
					methods: {
						'nom': function (order){
							return function (a, b) {
								return order * b.title.localeCompare(a.title);
							}
						},
						'nombre de pages': function (order){
							return function (a, b) {
								return order * (b.nbPages - a.nbPages);
							}
						},
						'date': function (order){
							return function (a, b) {
								return order * (b.date - a.date);
							}
						}
					},
					order: {
						'croissant': -1,
						'd&eacute;croissant': 1
					}
				},
				dLoader = new dataLoader({
					url: 'http://ulyssemalassagne.tumblr.com',
					filter: 'coords:',
					dataSet: {
						location: function(post){
							var loc;
							for (tag of post.tags) {
								if (tag.startsWith("location:")) {
									loc = tag.substr(9);
								}
							}
							return loc;
						},
						date: function(post){return Date.parse(post.date);},
						pic: "photo-url-500",
						ratio: function(post){return post.height/post.width;}
					},
					overwrite: true,
					sortBy: 'nombre de pages'
				},
				function(data){
					var container = document.getElementsByTagName("article")[0];
					tumblrMap(container)(data);
				});
			(function() {dLoader.requestPosts()})();
		</script>
	</head>
	<body>
		<article style="width: 1000px; margin: auto;">
			<div class="loader"></div>
		</article>
	</body>
</html>

